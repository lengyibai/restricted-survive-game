var J=Object.defineProperty;var Q=(e,i,t)=>i in e?J(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var o=(e,i,t)=>Q(e,typeof i!="symbol"?i+"":i,t);import{d as tt,r as et,o as it,c as st,a as rt,b as nt}from"./game_vue-DNU60DdV.js";import{g as M}from"./game_js_plgins-Do_FT7WX.js";import{j as C,k as at,l as ot,m as ht,n as lt,C as _,G as T,o as A,b as R,q as dt,t as S}from"./game_pixi-CSh3x5YB.js";import"./game_pixi_plgins-BvsMlnB0.js";import"./game_spine-ChIi9X2P.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();function ct(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}var B=ct,pt=typeof C=="object"&&C&&C.Object===Object&&C,ut=pt,ft=ut,gt=typeof self=="object"&&self&&self.Object===Object&&self,yt=ft||gt||Function("return this")(),G=yt,wt=G,mt=function(){return wt.Date.now()},bt=mt,Mt=/\s/;function St(e){for(var i=e.length;i--&&Mt.test(e.charAt(i)););return i}var vt=St,xt=vt,Pt=/^\s+/;function Tt(e){return e&&e.slice(0,xt(e)+1).replace(Pt,"")}var _t=Tt,It=G,Ct=It.Symbol,N=Ct,Z=N,X=Object.prototype,Et=X.hasOwnProperty,At=X.toString,P=Z?Z.toStringTag:void 0;function Wt(e){var i=Et.call(e,P),t=e[P];try{e[P]=void 0;var s=!0}catch{}var r=At.call(e);return s&&(i?e[P]=t:delete e[P]),r}var jt=Wt,kt=Object.prototype,Ot=kt.toString;function Zt(e){return Ot.call(e)}var Dt=Zt,D=N,Lt=jt,$t=Dt,Ft="[object Null]",Ht="[object Undefined]",L=D?D.toStringTag:void 0;function zt(e){return e==null?e===void 0?Ht:Ft:L&&L in Object(e)?Lt(e):$t(e)}var Rt=zt;function Bt(e){return e!=null&&typeof e=="object"}var Gt=Bt,Nt=Rt,Xt=Gt,Yt="[object Symbol]";function Vt(e){return typeof e=="symbol"||Xt(e)&&Nt(e)==Yt}var Ut=Vt,Kt=_t,$=B,qt=Ut,F=NaN,Jt=/^[-+]0x[0-9a-f]+$/i,Qt=/^0b[01]+$/i,te=/^0o[0-7]+$/i,ee=parseInt;function ie(e){if(typeof e=="number")return e;if(qt(e))return F;if($(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=$(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Kt(e);var t=Qt.test(e);return t||te.test(e)?ee(e.slice(2),t?2:8):Jt.test(e)?F:+e}var se=ie,re=B,j=bt,H=se,ne="Expected a function",ae=Math.max,oe=Math.min;function he(e,i,t){var s,r,n,a,h,l,c=0,u=!1,p=!1,f=!0;if(typeof e!="function")throw new TypeError(ne);i=H(i)||0,re(t)&&(u=!!t.leading,p="maxWait"in t,n=p?ae(H(t.maxWait)||0,i):n,f="trailing"in t?!!t.trailing:f);function m(d){var w=s,x=r;return s=r=void 0,c=d,a=e.apply(x,w),a}function g(d){return c=d,h=setTimeout(I,i),u?m(d):a}function b(d){var w=d-l,x=d-c,O=i-w;return p?oe(O,n-x):O}function y(d){var w=d-l,x=d-c;return l===void 0||w>=i||w<0||p&&x>=n}function I(){var d=j();if(y(d))return k(d);h=setTimeout(I,b(d))}function k(d){return h=void 0,f&&s?m(d):(s=r=void 0,a)}function K(){h!==void 0&&clearTimeout(h),c=0,s=l=r=h=void 0}function q(){return h===void 0?a:k(j())}function W(){var d=j(),w=y(d);if(s=arguments,r=this,l=d,w){if(h===void 0)return g(l);if(p)return clearTimeout(h),h=setTimeout(I,i),m(l)}return h===void 0&&(h=setTimeout(I,i)),a}return W.cancel=K,W.flush=q,W}var le=he;const Y=at(le),v=new ot({resizeTo:window,antialias:!1,resolution:window.devicePixelRatio||1,autoDensity:!0});v.view.addEventListener("contextmenu",e=>{e.preventDefault()});class de{constructor(){o(this,"currentScreen");const i=Y(()=>{this.updateViewSize()});window.addEventListener("resize",i)}updateViewSize(){var s,r;if(!this.currentScreen)return;const i=window.innerWidth,t=window.innerHeight;(r=(s=this.currentScreen).resize)==null||r.call(s,i,t)}async showScreen(i){this.currentScreen&&await this.hideAndRemoveScreen(this.currentScreen),this.addAndShowScreen(i),this.updateViewSize()}async hideAndRemoveScreen(i){return new Promise(t=>{M.to(i,{duration:.5,alpha:0,onComplete(){i.eventMode="none",i.visible=!1,i.destroy({children:!0}),t()}})})}addAndShowScreen(i){this.currentScreen=new i,v.stage.addChild(this.currentScreen),this.currentScreen.alpha=0,M.to(this.currentScreen,{duration:.5,alpha:1})}}const V=new de;class ce extends ht{constructor(i){const{text:t,fontSize:s=36,fontColor:r=16777215,stroke:n,strokeColor:a,strokeThickness:h,fontWeight:l="normal",anchor:c=0,wordWrap:u=!1,wordWrapWidth:p=100,lineHeight:f=1.25,align:m="left",indent:g=0,shadow:b}=i,y=new lt({fontSize:s,wordWrap:u,wordWrapWidth:p,fontWeight:l,lineHeight:f*s,breakWords:u,fill:r,align:m,fontFamily:"MicrosoftYaHei",stroke:n?a:"transparent",strokeThickness:n?h:0});b&&(y.dropShadow=!0,y.dropShadowColor=b[0],y.dropShadowAngle=b[1]*(Math.PI/180),y.dropShadowBlur=b[2],y.dropShadowDistance=b[3]),super(t,y),this.position.x=g*s,this.anchor.set(c)}setColor(i){this.style&&(this.style.fill=i)}setWordWrapWidth(i){this.style.wordWrapWidth=i}}class pe extends _{constructor(){super();o(this,"text");this.text=new ce({text:"X: 0, Y: 0",fontSize:50}),this.addChild(this.text)}setPlayerPosition(t,s){this.text.text=`X: ${t.toFixed(0)}, Y: ${s.toFixed(0)}`}}class ue extends T{constructor(t){super();o(this,"radius",0);o(this,"enableTint",!0);o(this,"bgColor","#fff");o(this,"borderWidth",0);o(this,"borderColor","black");o(this,"bgAlpha",1);const{x:s=0,y:r=0,width:n=0,height:a=0,bgColor:h="#fff",alpha:l=1,radius:c=0,borderWidth:u=0,borderColor:p="black",enableTint:f=!0,overflowHide:m=!1}=t;if(this.x=s,this.y=r,this.bgAlpha=l,this.radius=c,this.enableTint=f,this.bgColor=h,this.borderWidth=u,this.borderColor=p,this.renderBg(n,a),m){const g=new T;g.beginFill(16777215),g.drawRect(0,0,n,a),g.endFill(),this.addChild(g),this.mask=g}}updateColor(t){M.to(this,{tint:t,duration:.25})}renderBg(t,s){this.clear(),this.enableTint?(this.beginFill("#fff",this.bgAlpha),this.tint=this.bgColor):(this.beginFill(this.bgColor,this.bgAlpha),this.borderWidth&&this.lineStyle(this.borderWidth,this.borderColor,1)),this.borderWidth&&this.lineStyle(this.borderWidth,this.borderColor,1),this.radius!==0?typeof this.radius=="number"?this.drawRoundedRect(0,0,t,s,this.radius):(this.moveTo(0+this.radius[0],0),this.lineTo(0+t-this.radius[1],0),this.radius[1]>0?this.arcTo(0+t,0,0+t,0+this.radius[1],this.radius[1]):this.lineTo(0+t,0),this.lineTo(0+t,0+s-this.radius[2]),this.radius[2]>0?this.arcTo(0+t,0+s,0+t-this.radius[2],0+s,this.radius[2]):this.lineTo(0+t,0+s),this.lineTo(0+this.radius[3],0+s),this.radius[3]>0?this.arcTo(0,0+s,0,0+s-this.radius[3],this.radius[3]):this.lineTo(0,0+s),this.lineTo(0,0+this.radius[0]),this.radius[0]>0?this.arcTo(0,0,0+this.radius[0],0,this.radius[0]):this.lineTo(0,0),this.closePath()):this.drawRect(0,0,t,s),this.endFill()}showBorder(t){this.borderWidth=t?2:0,this.renderBg(this.width,this.height)}}const fe=e=>{const i=new T;return i.beginFill(16777215),i.drawRect(0,0,e.width,e.height),i.endFill(),e.addChild(i),e.mask=i,i},E=(e,i,t)=>{e.cursor="pointer",e.eventMode="static",e.on(i,t)};class ge{constructor(){o(this,"verticalScreenInfo",{width:0,height:0,scale:1});o(this,"horizontalScreenInfo",{width:0,height:0,scale:1});o(this,"updateViewSize",()=>{const i=v.screen.width,t=v.screen.height,s=i<t;this.horizontalScreenInfo.width=i,this.horizontalScreenInfo.height=t,this.horizontalScreenInfo.scale=Math.min(i/1920,t/1080),this.verticalScreenInfo.width=i,this.verticalScreenInfo.height=t,this.verticalScreenInfo.scale=s?i/1080:t/1080});this.updateViewSize(),window.addEventListener("resize",Y(this.updateViewSize,250))}}new ge;class ye extends _{constructor(t,s){super();o(this,"base");o(this,"thumb");o(this,"radius");o(this,"isDragging");o(this,"onMove");o(this,"result",{x:0,y:0});o(this,"onGlobalPointerMove",t=>{this.isDragging&&this.moveThumb(t)});this.radius=t,this.onMove=s,this.isDragging=!1,this.base=new T,this.base.beginFill(5592405,.5),this.base.drawCircle(0,0,t),this.base.endFill(),this.addChild(this.base),this.thumb=new T,this.thumb.beginFill(16777215),this.thumb.drawCircle(0,0,t/3),this.thumb.endFill(),this.addChild(this.thumb),E(this,"pointerdown",this.onPointerDown.bind(this)),E(this,"pointerup",this.onPointerUp.bind(this)),E(this,"pointerupoutside",this.onPointerUp.bind(this));const r=10;let n=0;const a=()=>{n+=A.shared.elapsedMS,n>=r&&(this.isDragging&&this.onMove(this.result.x,this.result.y),n=0)};A.shared.add(a,this)}onPointerDown(){this.isDragging=!0,window.addEventListener("pointermove",this.onGlobalPointerMove)}onPointerUp(){this.isDragging=!1,this.thumb.position.set(0,0),this.onMove(0,0),window.removeEventListener("pointermove",this.onGlobalPointerMove)}moveThumb(t){const s=t.clientX-this.x,r=t.clientY-this.y,n=Math.sqrt(s*s+r*r),a=Math.atan2(r,s);n>this.radius?(this.thumb.x=this.radius*Math.cos(a),this.thumb.y=this.radius*Math.sin(a)):(this.thumb.x=s,this.thumb.y=r);const h=this.thumb.x/this.radius,l=-(this.thumb.y/this.radius);this.result.x=h,this.result.y=l,Math.abs(h)>Math.abs(l)?this.result.x=h>0?1:-1:this.result.y=l>0?1:-1}}class U extends R{constructor(i,t){super(),this.width=i,this.height=t}}class z extends _{constructor(t,s,r){super();o(this,"fill");o(this,"bgColorFill");r?(this.bgColorFill=new ue({width:t,height:s,bgColor:r}),this.addChild(this.bgColorFill)):(this.fill=new U(t,s),this.addChild(this.fill))}setSize(t,s){this.fill&&(this.fill.width=t,this.fill.height=s),this.bgColorFill&&this.bgColorFill.renderBg(t,s)}}const we=(e,i,t,s,r=25)=>Math.sqrt(Math.pow(e-i,2)+Math.pow(t-s,2))/r/25,me=(e,i)=>{const t=e-window.innerWidth/2,s=window.innerHeight/2-i;return{x:t,y:s}};class be extends R{constructor(i){const{texture:t,width:s,height:r,anchor:n=0}=i;super(t),s&&(this.width=s),r&&(this.height=r),this.anchor.set(n)}}class Me extends _{constructor(){super();o(this,"MAP_SIZE",{width:3e3,height:3e3});o(this,"gameMap");o(this,"player");o(this,"targetPoint");o(this,"positionText");o(this,"moveDuration",0);o(this,"playerCenterStatus",{x:!0,y:!0});o(this,"playerMoveDirection",{left:!1,right:!1,up:!1,down:!1});const t=new U(window.innerWidth,window.innerHeight);this.addChild(t),fe(this),this.gameMap=new z(this.MAP_SIZE.width,this.MAP_SIZE.height),this.addChild(this.gameMap),this.gameMap.x=-this.MAP_SIZE.width/2+window.innerWidth/2,this.gameMap.y=-this.MAP_SIZE.height/2+window.innerHeight/2,E(this.gameMap,"pointertap",a=>{a.preventDefault();const{x:h,y:l}=a.page,c=Math.abs(this.gameMap.x)+h,u=Math.abs(this.gameMap.y)+l,{x:p,y:f}=me(h,l);this.movePlayer(c,u),this.moveMap(p,f),this.targetPoint.x=c,this.targetPoint.y=u});const s=new dt(S.get("grass"),this.MAP_SIZE.width,this.MAP_SIZE.height);this.gameMap.addChild(s),s.tileScale.x=.5,s.tileScale.y=.5,s.alpha=.75,this.targetPoint=new z(10,10,"#fff"),this.gameMap.addChild(this.targetPoint),this.player=new be({texture:S.get("player")}),this.gameMap.addChild(this.player),this.player.scale.set(.1),this.player.x=-this.gameMap.x+window.innerWidth/2-this.player.width/2,this.player.y=-this.gameMap.y+window.innerHeight/2-this.player.width/2,this.targetPoint.x=this.player.x+this.player.width/2-5,this.targetPoint.y=this.player.y+this.player.height/2-5,this.positionText=new pe,this.addChild(this.positionText);const r=new ye(100,(a,h)=>{this.gameMap.x-=a*10,this.player.x+=a*10,this.gameMap.y+=h*10,this.player.y-=h*10,this.player.x<=0&&(this.player.x=0),this.player.x>=this.MAP_SIZE.width-this.player.width&&(this.player.x=this.MAP_SIZE.width-this.player.width),this.player.y<=0&&(this.player.y=0),this.player.y>=this.MAP_SIZE.height-this.player.height&&(this.player.y=this.MAP_SIZE.height-this.player.height),this.gameMap.x>=0&&(this.gameMap.x=0),this.gameMap.x<=-this.MAP_SIZE.width+window.innerWidth&&(this.gameMap.x=-this.MAP_SIZE.width+window.innerWidth),this.gameMap.y>=0&&(this.gameMap.y=0),this.gameMap.y<=-this.MAP_SIZE.height+window.innerHeight&&(this.gameMap.y=-this.MAP_SIZE.height+window.innerHeight)});r.position.set(200,window.innerHeight-200),this.addChild(r),this.setKeyDownEvent();const n=()=>{const a=.1*A.shared.elapsedMS*10;this.playerMoveDirection.left&&this.player.x>0&&(this.gameMap.x+=a,this.player.x-=a),this.playerMoveDirection.right&&this.player.x<this.MAP_SIZE.width-this.player.width&&(this.gameMap.x-=a,this.player.x+=a),this.playerMoveDirection.up&&this.player.y>0&&(this.gameMap.y+=a,this.player.y-=a),this.playerMoveDirection.down&&this.player.y<this.MAP_SIZE.height-this.player.height&&(this.gameMap.y-=a,this.player.y+=a),this.gameMap.x>=0&&(this.gameMap.x=0),this.gameMap.x<=-this.MAP_SIZE.width+window.innerWidth&&(this.gameMap.x=-this.MAP_SIZE.width+window.innerWidth),this.gameMap.y>=0&&(this.gameMap.y=0),this.gameMap.y<=-this.MAP_SIZE.height+window.innerHeight&&(this.gameMap.y=-this.MAP_SIZE.height+window.innerHeight)};A.shared.add(n,this)}movePlayer(t,s){M.killTweensOf(this.player);let r=t-this.player.width/2,n=s-this.player.height/2;r<=0&&t<0&&(r=0),r>=this.MAP_SIZE.width-this.player.width&&t>0&&(r=this.MAP_SIZE.width-this.player.width),n<=0&&s>0&&(n=0),n>=this.MAP_SIZE.height-this.player.height&&s<0&&(n=this.MAP_SIZE.height-this.player.height),this.moveDuration=we(this.player.x,r,this.player.y,n),M.to(this.player,{x:r,y:n,duration:this.moveDuration,ease:"linear",onUpdate:()=>{const{x:a,y:h}=this.getPlayerInMapCoord();this.positionText.setPlayerPosition(a,h);const{x:l,y:c}=this.player.getGlobalPosition(),u=window.innerWidth/2,p=window.innerHeight/2;this.playerCenterStatus.x=Math.abs(l-u)<50,this.playerCenterStatus.y=Math.abs(c-p)<50}})}moveMap(t,s){M.killTweensOf(this.gameMap);let r=this.gameMap.x-t,n=this.gameMap.y+s;(r>=0&&t<0||!this.playerCenterStatus.x)&&(r=0),(r<=-this.MAP_SIZE.width+window.innerWidth&&t>0||!this.playerCenterStatus.x)&&(r=-this.MAP_SIZE.width+window.innerWidth),(n>=0&&s>0||!this.playerCenterStatus.y)&&(n=0),(n<=-this.MAP_SIZE.height+window.innerHeight&&s<0||!this.playerCenterStatus.y)&&(n=-this.MAP_SIZE.height+window.innerHeight),M.to(this.gameMap,{x:r,y:n,duration:this.moveDuration,ease:"linear"})}setKeyDownEvent(){const t={KeyW:"up",KeyA:"left",KeyS:"down",KeyD:"right"};window.addEventListener("keydown",s=>{this.playerMoveDirection[t[s.code]]=!0}),window.addEventListener("keyup",s=>{this.playerMoveDirection[t[s.code]]=!1})}getPlayerInMapCoord(){const t=this.player.x-this.MAP_SIZE.width/2,s=this.MAP_SIZE.height/2-this.y;return{x:t,y:s}}}const Se={grass:"img/grass.jpg",player:"img/player.png"},ve={},xe=async e=>{const{gameManifest:i,onProgress:t}=e;S.addBundle("gameManifest",i),await S.loadBundle("gameManifest",async s=>{t(s)})};class Pe extends _{constructor(){super(),this.init()}async init(){const i=()=>{location.reload()};S.addBundle("loadingManifest",ve),await S.loadBundle("loadingManifest"),window.addEventListener("online",i),await xe({gameManifest:Se,onProgress:t=>{t===1&&V.showScreen(Me)}}),window.removeEventListener("online",i)}resize(i,t){}}const Te=tt({__name:"index",setup(e){const i=et();return it(async()=>{i.value&&(i.value.append(v.view),globalThis.__PIXI_APP__=v,V.showScreen(Pe))}),(t,s)=>(rt(),st("div",{ref_key:"appRef",ref:i},null,512))}}),_e=nt(Te);_e.mount("#app");
